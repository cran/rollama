<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Maximilian Weber and Johannes B. Gruber" />


<title>annotation</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">annotation</h1>
<h4 class="author">Maximilian Weber and Johannes B. Gruber</h4>



<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>After you installed Ollama on your machine and downloaded the package
rollama you can load the package and pull a model. The default model
(<code>llama3.1</code>), is a good all-round chat model. For annotation,
however, the instruction tuned llama models are often better suited, as
they follow instructions more diligently and are less likely to trail
off into a conversation. By changing the option
<code>rollama_model</code>, we can change which model is used by default
in the current session:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(rollama)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">options</span>(<span class="at">rollama_model =</span> <span class="st">&quot;llama3.2:3b-instruct-q8_0&quot;</span>)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">pull_model</span>()</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="co">#&gt; ✔ model llama3.2:3b-instruct-q8_0 pulled succesfully</span></span></code></pre></div>
</div>
<div id="prompting-strategies" class="section level1">
<h1>Prompting Strategies</h1>
<p>If you want to annotate textual data, you can use various prompting
strategies. For an overview of common approaches, you can read a paper
by <a href="https://arxiv.org/abs/2401.00284">Weber and Reichardt
(2023)</a>. These strategies primarily differ in whether or how many
examples are given (Zero-shot, One-shot, or Few-shot) and whether
reasoning is involved (Chain-of-Thought).</p>
<p>When writing a prompt we can give the model content for the system
part, user part and assistant part. The system message typically
includes instructions or context that guides the interaction, setting
the stage for how the user and the assistant should interact. For an
annotation task we could write: “You assign texts into categories.
Answer with just the correct category.” The table below summarizes
different prompting strategies for annotating textual data. Each
strategy varies in the number of examples given and the incorporation of
reasoning.</p>
<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th>Prompting Strategy</th>
<th>Example Structure</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Zero-shot</td>
<td><code>{&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: &quot;Text of System Prompt&quot;},</code><br><code>{&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;(Text to classify) + classification question&quot;}</code></td>
</tr>
<tr class="even">
<td>One-shot</td>
<td><code>{&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: &quot;Text of System Prompt&quot;},</code><br><code>{&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;(Example text) + classification question&quot;},</code><br><code>{&quot;role&quot;: &quot;assistant&quot;, &quot;content&quot;: &quot;Example classification&quot;},</code><br><code>{&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;(Text to classify) + classification question&quot;}</code></td>
</tr>
<tr class="odd">
<td>Few-shot</td>
<td><code>{&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: &quot;Text of System Prompt&quot;},</code><br><code>{&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;(Example text) + classification question&quot;},</code><br><code>{&quot;role&quot;: &quot;assistant&quot;, &quot;content&quot;: &quot;Example classification&quot;},</code><br><code>{&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;(Example text) + classification question&quot;},</code><br><code>{&quot;role&quot;: &quot;assistant&quot;, &quot;content&quot;: &quot;Example classification&quot;},</code><br><code>. . . more examples</code><br><code>{&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;(Text to classify) + classification question&quot;}</code></td>
</tr>
<tr class="even">
<td>Chain-of-Thought</td>
<td><code>{&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: &quot;Text of System Prompt&quot;},</code><br><code>{&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;(Text to classify) + reasoning question&quot;},</code><br><code>{&quot;role&quot;: &quot;assistant&quot;, &quot;content&quot;: &quot;Reasoning&quot;},</code><br><code>{&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;Classification question&quot;}</code></td>
</tr>
</tbody>
</table>
<div id="zero-shot" class="section level2">
<h2>Zero-shot</h2>
<p>In this approach, no prior examples are given. The structure includes
a system prompt providing instructions and a user prompt with the text
to classify and the classification question (in this example we only
provide the categories).</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">library</span>(tibble)</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>q <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>  <span class="sc">~</span>role,    <span class="sc">~</span>content,</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>  <span class="st">&quot;system&quot;</span>, <span class="st">&quot;You assign texts into categories. Answer with just the correct category.&quot;</span>,</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>  <span class="st">&quot;user&quot;</span>,   <span class="st">&quot;text: the pizza tastes terrible</span><span class="sc">\n</span><span class="st">categories: positive, neutral, negative&quot;</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>)</span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a><span class="fu">query</span>(q)</span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a><span class="co">#&gt; ── Answer from llama3.2:3b-instruct-q8_0 ─────────────────────────────</span></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a><span class="co">#&gt; negative</span></span></code></pre></div>
</div>
<div id="one-shot" class="section level2">
<h2>One-shot</h2>
<p>This involves giving a single example before the actual task. The
structure includes a system prompt, followed by a user prompt with an
example text and classification question, the assistant’s example
classification, and then another user prompt with the new text to
classify.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>q <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>  <span class="sc">~</span>role,    <span class="sc">~</span>content,</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>  <span class="st">&quot;system&quot;</span>, <span class="st">&quot;You assign texts into categories. Answer with just the correct category.&quot;</span>,</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>  <span class="st">&quot;user&quot;</span>, <span class="st">&quot;text: the pizza tastes terrible</span><span class="sc">\n</span><span class="st">categories: positive, neutral, negative&quot;</span>,</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>  <span class="st">&quot;assistant&quot;</span>, <span class="st">&quot;Category: Negative&quot;</span>,</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>  <span class="st">&quot;user&quot;</span>, <span class="st">&quot;text: the service is great</span><span class="sc">\n</span><span class="st">categories: positive, neutral, negative&quot;</span></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>)</span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a><span class="fu">query</span>(q)</span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a><span class="co">#&gt; ── Answer from llama3.2:3b-instruct-q8_0 ─────────────────────────────</span></span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a><span class="co">#&gt; Category: Positive</span></span></code></pre></div>
<p>A nice side effect of the one-shot strategy (and all
n&gt;0-strategies) is that you can tune the format the model uses in its
replies. For example, if you want to have an output that easy to parse,
you could change the assistant message to
<code>&quot;{&#39;Category&#39;:&#39;Negative&#39;}&quot;</code></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>q <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>  <span class="sc">~</span>role,    <span class="sc">~</span>content,</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>  <span class="st">&quot;system&quot;</span>, <span class="st">&quot;You assign texts into categories. Answer with just the correct category.&quot;</span>,</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>  <span class="st">&quot;user&quot;</span>, <span class="st">&quot;text: the pizza tastes terrible</span><span class="sc">\n</span><span class="st">categories: positive, neutral, negative&quot;</span>,</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>  <span class="st">&quot;assistant&quot;</span>, <span class="st">&quot;{&#39;Category&#39;:&#39;Negative&#39;}&quot;</span>,</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>  <span class="st">&quot;user&quot;</span>, <span class="st">&quot;text: the service is great</span><span class="sc">\n</span><span class="st">categories: positive, neutral, negative&quot;</span></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>)</span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a>answer <span class="ot">&lt;-</span> <span class="fu">query</span>(q)</span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a><span class="co">#&gt; ── Answer from llama3.2:3b-instruct-q8_0 ─────────────────────────────</span></span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a><span class="co">#&gt; {&#39;Category&#39;:&#39;Positive&#39;}</span></span></code></pre></div>
<p>This is a valid JSON return and can be parsed into a list with, e.g.,
<code>jsonlite::fromJSON()</code>. Using this logic, we could request a
more informative output:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>q <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>  <span class="sc">~</span>role,    <span class="sc">~</span>content,</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>  <span class="st">&quot;system&quot;</span>, <span class="st">&quot;You assign texts into categories. Provide the following information: category, confidence, and the word that is most important for your coding decision.&quot;</span>,</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>  <span class="st">&quot;user&quot;</span>, <span class="st">&quot;text: the pizza tastes terrible</span><span class="sc">\n</span><span class="st">categories: positive, neutral, negative&quot;</span>,</span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>  <span class="st">&quot;assistant&quot;</span>, <span class="st">&quot;{&#39;Category&#39;:&#39;Negative&#39;,&#39;Confidence&#39;:&#39;100%&#39;,&#39;Important&#39;:&#39;terrible&#39;}&quot;</span>,</span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>  <span class="st">&quot;user&quot;</span>, <span class="st">&quot;text: the service is great</span><span class="sc">\n</span><span class="st">categories: positive, neutral, negative&quot;</span></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>)</span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a>answer <span class="ot">&lt;-</span> <span class="fu">query</span>(q)</span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a><span class="co">#&gt; ── Answer from llama3.2:3b-instruct-q8_0 ─────────────────────────────</span></span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a><span class="co">#&gt; {&#39;Category&#39;:&#39;Positive&#39;,&#39;Confidence&#39;:&#39;100%&#39;,&#39;Important&#39;:&#39;great&#39;}</span></span></code></pre></div>
<p>By using <code>pluck(answer, &quot;message&quot;, &quot;content&quot;)</code>, you can
directly extract the result and don’t need to copy it from screen.</p>
</div>
<div id="few-shot" class="section level2">
<h2>Few-shot</h2>
<p>This strategy includes multiple examples (more than one). The
structure is similar to one-shot but with several iterations of user and
assistant messages providing examples before the final text to
classify.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>q <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>  <span class="sc">~</span>role,    <span class="sc">~</span>content,</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>  <span class="st">&quot;system&quot;</span>, <span class="st">&quot;You assign texts into categories. Answer with just the correct category.&quot;</span>,</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>  <span class="st">&quot;user&quot;</span>, <span class="st">&quot;text: the pizza tastes terrible</span><span class="sc">\n</span><span class="st">categories: positive, neutral, negative&quot;</span>,</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>  <span class="st">&quot;assistant&quot;</span>, <span class="st">&quot;Category: Negative&quot;</span>,</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>  <span class="st">&quot;user&quot;</span>, <span class="st">&quot;text: the service is great</span><span class="sc">\n</span><span class="st">categories: positive, neutral, negative&quot;</span>,</span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>  <span class="st">&quot;assistant&quot;</span>, <span class="st">&quot;Category: Positive&quot;</span>,</span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a>  <span class="st">&quot;user&quot;</span>, <span class="st">&quot;text: I once came here with my wife</span><span class="sc">\n</span><span class="st">categories: positive, neutral, negative&quot;</span>,</span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a>  <span class="st">&quot;assistant&quot;</span>, <span class="st">&quot;Category: Neutral&quot;</span>,</span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a>  <span class="st">&quot;user&quot;</span>, <span class="st">&quot;text: I once ate pizza</span><span class="sc">\n</span><span class="st">categories: positive, neutral, negative&quot;</span></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a>)</span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a><span class="fu">query</span>(q)</span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a><span class="co">#&gt; ── Answer from llama3.2:3b-instruct-q8_0 ─────────────────────────────</span></span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a><span class="co">#&gt; Category: Neutral</span></span></code></pre></div>
</div>
<div id="chain-of-thought" class="section level2">
<h2>Chain-of-Thought</h2>
<p>This approach involves at least one reasoning step. The structure
here starts with the system prompt, then a user prompt with a text to
classify and a reasoning question.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>q_thought <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>  <span class="sc">~</span>role,    <span class="sc">~</span>content,</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>  <span class="st">&quot;system&quot;</span>, <span class="st">&quot;You assign texts into categories. &quot;</span>,</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>  <span class="st">&quot;user&quot;</span>,   <span class="st">&quot;text: the pizza tastes terrible</span><span class="sc">\n</span><span class="st">What sentiment (positive, neutral, or negative) would you assign? Provide some thoughts.&quot;</span></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>)</span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>output_thought <span class="ot">&lt;-</span> <span class="fu">query</span>(q_thought, <span class="at">output =</span> <span class="st">&quot;text&quot;</span>)</span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a><span class="co">#&gt; ── Answer from llama3.2:3b-instruct-q8_0 ─────────────────────────────</span></span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a><span class="co">#&gt; I would assign a negative sentiment to this text.</span></span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a><span class="co">#&gt; Here&#39;s why:</span></span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a><span class="co">#&gt; * The word &quot;terrible&quot; is a strong adjective that conveys a strong</span></span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a><span class="co">#&gt; negative opinion.</span></span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a><span class="co">#&gt; * The tone of the sentence is also quite critical and dismissive.</span></span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a><span class="co">#&gt; * There are no positive or neutral phrases in the text, which</span></span>
<span id="cb7-17"><a href="#cb7-17" tabindex="-1"></a><span class="co">#&gt; suggests that the author has a clear dislike for the pizza.</span></span>
<span id="cb7-18"><a href="#cb7-18" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-19"><a href="#cb7-19" tabindex="-1"></a><span class="co">#&gt; Overall, the language and tone used in this text indicate a strong</span></span>
<span id="cb7-20"><a href="#cb7-20" tabindex="-1"></a><span class="co">#&gt; negative sentiment towards the pizza.</span></span></code></pre></div>
<p>In the next step we can use the assistant’s reasoning and a user
prompt with the classification question.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>q <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>  <span class="sc">~</span>role,    <span class="sc">~</span>content,</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>  <span class="st">&quot;system&quot;</span>, <span class="st">&quot;You assign texts into categories. &quot;</span>,</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>  <span class="st">&quot;user&quot;</span>,   <span class="st">&quot;text: the pizza tastes terrible</span><span class="sc">\n</span><span class="st">What sentiment (positive, neutral, or negative) would you assign? Provide some thoughts.&quot;</span>,</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>  <span class="st">&quot;assistant&quot;</span>, output_thought,</span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>  <span class="st">&quot;user&quot;</span>,   <span class="st">&quot;Now answer with just the correct category (positive, neutral, or negative)&quot;</span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a>)</span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a>resps <span class="ot">&lt;-</span> <span class="fu">query</span>(q)</span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a><span class="co">#&gt; ── Answer from llama3.2:3b-instruct-q8_0 ─────────────────────────────</span></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a><span class="co">#&gt; Negative</span></span></code></pre></div>
</div>
<div id="the-make_query-helper-function" class="section level2">
<h2>The <code>make_query</code> helper function</h2>
<p>The <code>make_query</code> function is designed to facilitate the
creation of a structured query for text classification, so that you do
not need to build the tibble yourself and remember the specific
structure.</p>
<p>Components:</p>
<ul>
<li><strong>text</strong> to Classify: The new text(s) to be
annotated.</li>
<li><strong>prompt</strong>: Classification question with the categories
to be annotated.</li>
<li><strong>template</strong>: Defines the structure for user messages.
Defines the structure for user messages. The template can include
placeholders like {text}, {prefix}, and {suffix} to dynamically format
input.</li>
<li><strong>system</strong>: System Prompt: Provides context or
instructions for the classification task (optional).</li>
<li><strong>prefix</strong>: A string to prepend to user queries
(optional).</li>
<li><strong>suffix</strong>: A string to append to user queries
(optional).</li>
<li><strong>examples</strong>: Prior examples consisting of user
messages and assistant responses (for one-shot and few-shot
learning)(optional).</li>
</ul>
</div>
<div id="example-usage" class="section level2">
<h2>Example usage</h2>
<div id="zero-shot-example" class="section level3">
<h3>Zero-shot example</h3>
<p>In this example, the function is used without any examples.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="co"># Call the make_query function</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>q_zs <span class="ot">&lt;-</span> <span class="fu">make_query</span>(</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>  <span class="at">template =</span> <span class="st">&quot;{text}</span><span class="sc">\n</span><span class="st">{prompt}&quot;</span>,</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>  <span class="at">text =</span> <span class="st">&quot;the pizza tastes terrible&quot;</span>,</span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>  <span class="at">prompt =</span> <span class="st">&quot;Categories: positive, neutral, negative&quot;</span>,</span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>  <span class="at">system =</span> <span class="st">&quot;You assign texts into categories. Answer with just the correct category.&quot;</span>,</span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a>)</span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a><span class="co"># Print the query</span></span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a><span class="fu">print</span>(q_zs)</span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a><span class="co">#&gt; # A tibble: 2 × 2</span></span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a><span class="co">#&gt;   role   content                                                      </span></span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;  &lt;glue&gt;                                                       </span></span>
<span id="cb9-15"><a href="#cb9-15" tabindex="-1"></a><span class="co">#&gt; 1 system You assign texts into categories. Answer with just the corre…</span></span>
<span id="cb9-16"><a href="#cb9-16" tabindex="-1"></a><span class="co">#&gt; 2 user   the pizza tastes terrible</span></span>
<span id="cb9-17"><a href="#cb9-17" tabindex="-1"></a><span class="co">#&gt; Categories: positive, neutral, nega…</span></span>
<span id="cb9-18"><a href="#cb9-18" tabindex="-1"></a><span class="co"># Run the query</span></span>
<span id="cb9-19"><a href="#cb9-19" tabindex="-1"></a><span class="fu">query</span>(q_zs)</span>
<span id="cb9-20"><a href="#cb9-20" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-21"><a href="#cb9-21" tabindex="-1"></a><span class="co">#&gt; ── Answer from llama3.2:3b-instruct-q8_0 ─────────────────────────────</span></span>
<span id="cb9-22"><a href="#cb9-22" tabindex="-1"></a><span class="co">#&gt; negative</span></span></code></pre></div>
</div>
<div id="one-shot-example" class="section level3">
<h3>One-shot example</h3>
<p>Here, one prior example is provided to aid the classification:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>examples_os <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tribble</span>(</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>  <span class="sc">~</span>text, <span class="sc">~</span>answer,</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>  <span class="st">&quot;the pizza tastes terrible&quot;</span>, <span class="st">&quot;negative&quot;</span></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>)</span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a>q_os <span class="ot">&lt;-</span> <span class="fu">make_query</span>(</span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a>  <span class="at">text =</span> <span class="st">&quot;the service is great&quot;</span>,</span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a>  <span class="at">template =</span> <span class="st">&quot;{text}</span><span class="sc">\n</span><span class="st">{prompt}&quot;</span>,</span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a>  <span class="at">prompt =</span> <span class="st">&quot;Categories: positive, neutral, negative&quot;</span>,</span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a>  <span class="at">system =</span> <span class="st">&quot;You assign texts into categories. Answer with just the correct category.&quot;</span>,</span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a>  <span class="at">example =</span> examples_os,</span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a>)</span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a><span class="fu">print</span>(q_os)</span>
<span id="cb10-14"><a href="#cb10-14" tabindex="-1"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb10-15"><a href="#cb10-15" tabindex="-1"></a><span class="co">#&gt; # A tibble: 4 × 2</span></span>
<span id="cb10-16"><a href="#cb10-16" tabindex="-1"></a><span class="co">#&gt;   role      content                                                   </span></span>
<span id="cb10-17"><a href="#cb10-17" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;     &lt;glue&gt;                                                    </span></span>
<span id="cb10-18"><a href="#cb10-18" tabindex="-1"></a><span class="co">#&gt; 1 system    You assign texts into categories. Answer with just the co…</span></span>
<span id="cb10-19"><a href="#cb10-19" tabindex="-1"></a><span class="co">#&gt; 2 user      the pizza tastes terrible</span></span>
<span id="cb10-20"><a href="#cb10-20" tabindex="-1"></a><span class="co">#&gt; Categories: positive, neutral, n…</span></span>
<span id="cb10-21"><a href="#cb10-21" tabindex="-1"></a><span class="co">#&gt; 3 assistant negative                                                  </span></span>
<span id="cb10-22"><a href="#cb10-22" tabindex="-1"></a><span class="co">#&gt; 4 user      the service is great</span></span>
<span id="cb10-23"><a href="#cb10-23" tabindex="-1"></a><span class="co">#&gt; Categories: positive, neutral, negati…</span></span>
<span id="cb10-24"><a href="#cb10-24" tabindex="-1"></a></span>
<span id="cb10-25"><a href="#cb10-25" tabindex="-1"></a><span class="fu">query</span>(q_os)</span>
<span id="cb10-26"><a href="#cb10-26" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb10-27"><a href="#cb10-27" tabindex="-1"></a><span class="co">#&gt; ── Answer from llama3.2:3b-instruct-q8_0 ─────────────────────────────</span></span>
<span id="cb10-28"><a href="#cb10-28" tabindex="-1"></a><span class="co">#&gt; positive</span></span></code></pre></div>
</div>
<div id="few-shot-example-with-multiple-examples" class="section level3">
<h3>Few-shot example with multiple examples</h3>
<p>This scenario uses multiple examples to enrich the context for the
new classification:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>examples_fs <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tribble</span>(</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>  <span class="sc">~</span>text, <span class="sc">~</span>answer,</span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>  <span class="st">&quot;the pizza tastes terrible&quot;</span>, <span class="st">&quot;negative&quot;</span>,</span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>  <span class="st">&quot;the service is great&quot;</span>, <span class="st">&quot;positive&quot;</span>,</span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a>  <span class="st">&quot;I once came here with my wife&quot;</span>, <span class="st">&quot;neutral&quot;</span></span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a>)</span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a>q_fs <span class="ot">&lt;-</span> <span class="fu">make_query</span>(</span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a>  <span class="at">text =</span> <span class="st">&quot;I once ate pizza&quot;</span>,</span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a>  <span class="at">prompt =</span> <span class="st">&quot;Categories: positive, neutral, negative&quot;</span>,</span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a>  <span class="at">template =</span> <span class="st">&quot;{text}</span><span class="sc">\n</span><span class="st">{prompt}&quot;</span>,</span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a>  <span class="at">system =</span> <span class="st">&quot;You assign texts into categories. Answer with just the correct category.&quot;</span>,</span>
<span id="cb11-13"><a href="#cb11-13" tabindex="-1"></a>  <span class="at">examples =</span> examples_fs</span>
<span id="cb11-14"><a href="#cb11-14" tabindex="-1"></a>)</span>
<span id="cb11-15"><a href="#cb11-15" tabindex="-1"></a></span>
<span id="cb11-16"><a href="#cb11-16" tabindex="-1"></a><span class="fu">query</span>(q_fs)</span>
<span id="cb11-17"><a href="#cb11-17" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb11-18"><a href="#cb11-18" tabindex="-1"></a><span class="co">#&gt; ── Answer from llama3.2:3b-instruct-q8_0 ─────────────────────────────</span></span>
<span id="cb11-19"><a href="#cb11-19" tabindex="-1"></a><span class="co">#&gt; neutral</span></span></code></pre></div>
</div>
</div>
</div>
<div id="batch-annotation" class="section level1">
<h1>Batch annotation</h1>
<p>In practice, you probably never want to annotate just one text,
except maybe for testing. Instead you normally have a collections of
texts, which is why <code>make_query</code> takes a vector for the
<code>text</code> argument. In this section, we highlight how this is
useful with an example batch of texts.</p>
</div>
<div id="example-using-a-dataframe" class="section level1">
<h1>Example using a dataframe</h1>
<p>This example demonstrates how to perform sentiment analysis on a set
of movie reviews. The process involves creating a dataframe of reviews,
processing each review to classify its sentiment, and appending the
results as a new column in the dataframe.</p>
<p>We create a dataframe named <code>movie_reviews</code> with two
columns:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="co"># Create an example dataframe with 5 movie reviews</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>movie_reviews <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>  <span class="at">review_id =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>  <span class="at">review =</span> <span class="fu">c</span>(<span class="st">&quot;A stunning visual spectacle with a gripping storyline.&quot;</span>,</span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>             <span class="st">&quot;The plot was predictable, but the acting was superb.&quot;</span>,</span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a>             <span class="st">&quot;An overrated film with underwhelming performances.&quot;</span>,</span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a>             <span class="st">&quot;A beautiful tale of love and adventure, beautifully shot.&quot;</span>,</span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a>             <span class="st">&quot;The movie lacked depth, but the special effects were incredible.&quot;</span>)</span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a>)</span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a><span class="co"># Print the initial dataframe</span></span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a>movie_reviews</span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a><span class="co">#&gt; # A tibble: 5 × 2</span></span>
<span id="cb12-13"><a href="#cb12-13" tabindex="-1"></a><span class="co">#&gt;   review_id review                                                    </span></span>
<span id="cb12-14"><a href="#cb12-14" tabindex="-1"></a><span class="co">#&gt;       &lt;int&gt; &lt;chr&gt;                                                     </span></span>
<span id="cb12-15"><a href="#cb12-15" tabindex="-1"></a><span class="co">#&gt; 1         1 A stunning visual spectacle with a gripping storyline.    </span></span>
<span id="cb12-16"><a href="#cb12-16" tabindex="-1"></a><span class="co">#&gt; 2         2 The plot was predictable, but the acting was superb.      </span></span>
<span id="cb12-17"><a href="#cb12-17" tabindex="-1"></a><span class="co">#&gt; 3         3 An overrated film with underwhelming performances.        </span></span>
<span id="cb12-18"><a href="#cb12-18" tabindex="-1"></a><span class="co">#&gt; 4         4 A beautiful tale of love and adventure, beautifully shot. </span></span>
<span id="cb12-19"><a href="#cb12-19" tabindex="-1"></a><span class="co">#&gt; 5         5 The movie lacked depth, but the special effects were incr…</span></span></code></pre></div>
<p>We can use <code>make_query</code> again to define a query for each
of these reviews. What we want to do is to perform a sentiment analysis,
guided by a system message and a classification question.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="co"># Process each review using make_query</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>queries <span class="ot">&lt;-</span> <span class="fu">make_query</span>(</span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a>  <span class="at">text =</span> movie_reviews<span class="sc">$</span>review,</span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a>  <span class="at">prompt =</span> <span class="st">&quot;Categories: positive, neutral, negative&quot;</span>,</span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a>  <span class="at">template =</span> <span class="st">&quot;{prefix}{text}</span><span class="sc">\n</span><span class="st">{prompt}&quot;</span>,</span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a>  <span class="at">system =</span> <span class="st">&quot;Classify the sentiment of the movie review. Answer with just the correct category.&quot;</span>,</span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a>  <span class="at">prefix =</span> <span class="st">&quot;Text to classify: &quot;</span></span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a>)</span></code></pre></div>
<p>This produces a list of data.frames that have the same query format
we are now familiar with. All of them have the same prompt, system
message and prefix, but each has a different text that came from the
movie reviews data.frame we created above. The <code>query</code>
function accepts lists of queries, so we can get the annotations simply
using:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="co"># Process and annotate the movie reviews</span></span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>movie_reviews<span class="sc">$</span>annotation <span class="ot">&lt;-</span> <span class="fu">query</span>(queries, <span class="at">screen =</span> <span class="cn">FALSE</span>, <span class="at">output =</span> <span class="st">&quot;text&quot;</span>)</span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a><span class="co"># Print the annotated dataframe</span></span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a>movie_reviews</span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a><span class="co">#&gt; # A tibble: 5 × 3</span></span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a><span class="co">#&gt;   review_id review                                          annotation</span></span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a><span class="co">#&gt;       &lt;int&gt; &lt;chr&gt;                                           &lt;chr&gt;     </span></span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a><span class="co">#&gt; 1         1 A stunning visual spectacle with a gripping st… Positive  </span></span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a><span class="co">#&gt; 2         2 The plot was predictable, but the acting was s… positive  </span></span>
<span id="cb14-11"><a href="#cb14-11" tabindex="-1"></a><span class="co">#&gt; 3         3 An overrated film with underwhelming performan… Negative  </span></span>
<span id="cb14-12"><a href="#cb14-12" tabindex="-1"></a><span class="co">#&gt; 4         4 A beautiful tale of love and adventure, beauti… Positive  </span></span>
<span id="cb14-13"><a href="#cb14-13" tabindex="-1"></a><span class="co">#&gt; 5         5 The movie lacked depth, but the special effect… Neutral</span></span></code></pre></div>
<p>We can also use this approach in a ‘tidy’ coding style:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="fu">library</span>(dplyr, <span class="at">warn.conflicts =</span> <span class="cn">FALSE</span>)</span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>movie_reviews_annotated <span class="ot">&lt;-</span> movie_reviews <span class="sc">|&gt;</span></span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a>    <span class="at">sentiment =</span> <span class="fu">make_query</span>(</span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a>      <span class="at">text =</span> review,</span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a>      <span class="at">prompt =</span> <span class="st">&quot;Categories: positive, neutral, negative&quot;</span>,</span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a>      <span class="at">template =</span> <span class="st">&quot;{prefix}{text}</span><span class="sc">\n</span><span class="st">{prompt}&quot;</span>,</span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a>      <span class="at">system =</span> <span class="st">&quot;Classify the sentiment of the movie review. Answer with just the correct category.&quot;</span>,</span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a>      <span class="at">prefix =</span> <span class="st">&quot;Text to classify: &quot;</span></span>
<span id="cb15-10"><a href="#cb15-10" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb15-11"><a href="#cb15-11" tabindex="-1"></a>      <span class="fu">query</span>(<span class="at">screen =</span> <span class="cn">FALSE</span>, <span class="at">output =</span> <span class="st">&quot;text&quot;</span>)</span>
<span id="cb15-12"><a href="#cb15-12" tabindex="-1"></a>  )</span>
<span id="cb15-13"><a href="#cb15-13" tabindex="-1"></a>movie_reviews_annotated</span>
<span id="cb15-14"><a href="#cb15-14" tabindex="-1"></a><span class="co">#&gt; # A tibble: 5 × 4</span></span>
<span id="cb15-15"><a href="#cb15-15" tabindex="-1"></a><span class="co">#&gt;   review_id review                                annotation sentiment</span></span>
<span id="cb15-16"><a href="#cb15-16" tabindex="-1"></a><span class="co">#&gt;       &lt;int&gt; &lt;chr&gt;                                 &lt;chr&gt;      &lt;chr&gt;    </span></span>
<span id="cb15-17"><a href="#cb15-17" tabindex="-1"></a><span class="co">#&gt; 1         1 A stunning visual spectacle with a g… Positive   Positive </span></span>
<span id="cb15-18"><a href="#cb15-18" tabindex="-1"></a><span class="co">#&gt; 2         2 The plot was predictable, but the ac… positive   positive </span></span>
<span id="cb15-19"><a href="#cb15-19" tabindex="-1"></a><span class="co">#&gt; 3         3 An overrated film with underwhelming… Negative   Negative </span></span>
<span id="cb15-20"><a href="#cb15-20" tabindex="-1"></a><span class="co">#&gt; 4         4 A beautiful tale of love and adventu… Positive   Positive </span></span>
<span id="cb15-21"><a href="#cb15-21" tabindex="-1"></a><span class="co">#&gt; 5         5 The movie lacked depth, but the spec… Neutral    Neutral</span></span></code></pre></div>
<p>This takes a little longer than classic supervised machine learning
or even classification with transformer models. However, the advantage
is that instructions can be provided using plain English, the models
need very few examples to perform surprisingly well, and the best
models, like <code>llama3.2</code>, can often deal with more complex
categories than other approaches.</p>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
